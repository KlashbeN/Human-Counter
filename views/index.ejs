<!-- views/pages/index.ejs -->

<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8"/>
        <title>
            Google Vision Human Counter
        </title>
        <% include head %>
    </head>
    <body class="container">
        <header>
            <% include header %>
        </header>
        <script src="https://www.gstatic.com/firebasejs/3.2.0/firebase.js"></script>
        <script>
            document.addEventListener('DOMContentLoaded', function() {
              var file = document.getElementById('file');

            // Initialize Firebase
            var config = {
                apiKey: "AIzaSyAmZB2B45FM36JryBmop4qd26I_AVyqf3g",
                authDomain: "vision-recognition-1338.firebaseapp.com",
                databaseURL: "https://vision-recognition-1338.firebaseio.com",
                storageBucket: "vision-recognition-1338.appspot.com",
            };
            var app = firebase.initializeApp(config),
                database = app.database(),
                storage = app.storage();

                // Handling image uploads to Firebase storage
                function handleImageFile(e) {
                  e.preventDefault();
                  var files = e.target.files,
                  i,file;
                  var uploadImage = storage.ref().child(file.name).put(file);
                  uploadImage.on('state_changed',null,function(error) {
                    console.log('Upload to Firebase storage failed', error)
                  }, function() {
                    console.log('Upload successful to Firebase storage')
                  }.bind(uploadImage));
                  return false;

                  
                }
                file.addEventListener('change',handleImageFile, false);

          });
        </script>


        <main>
            <div class="row">
                <div class="col-sm-8">
                    <div class="jumbotron">
                        <h1>Google project</h1>
                        <p>Vision Recognition</p>
                        <form>
                            Number of service counter:
                            <input type="text" name="numOfCounter"><br>
                        </form>
                        <form>
                            <input type="file" id="file" name="filename" accept="image/jpg, image/png">
                        </form>
                        <ul>
                            <% images.forEach(function(images) { %>
                                <img src='<%= images.url %>'/>
                                <li>
                                    <strong><%=images.name %></strong>
                                    There are
                                    <%= images.numOfPeople %>
                                    people in the image at
                                    <%= images.time %>.</li>
                            <% }); %>
                        </ul>
                    </div>
                </div>
            </div>
        </main>

        <script>
            (function(i, s, o, g, r, a, m) {
                i['GoogleAnalyticsObject'] = r;
                i[r] = i[r] || function() {
                    (i[r].q = i[r].q || []).push(arguments)
                },
                i[r].l = 1 * new Date();
                a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
                a.async = 1;
                a.src = g;
                m.parentNode.insertBefore(a, m)
            })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

            ga('create', 'UA-79208871-1', 'auto');
            ga('send', 'pageview');
        </script>

    </body>
</html>
